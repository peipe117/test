<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥å­ç·´ç¿’ç³»çµ±</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            body {
                background-color: white;
                height: auto;
                overflow: visible;
            }
        }
        
        .print-only {
            display: none;
        }

        /* ç‘èŠ±å‹•ç•« */
        @keyframes confetti-fall {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .confetti-piece {
            position: fixed;
            pointer-events: none;
            z-index: 50;
            top: -20px;
        }

        /* æ‹–æ›³æ™‚çš„æ¨£å¼ */
        .dragging {
            opacity: 0.4;
        }
        
        .drag-over {
            border: 2px dashed #F59E0B; /* amber-500 */
            background-color: #FEF3C7; /* amber-100 */
        }

        /* ç¦æ­¢é¸å–æ–‡å­—ï¼Œé¿å…æ‹–æ›³æ™‚é¸åˆ°æ–‡å­— */
        .noselect {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* æ¨¡æ…‹è¦–çª—èƒŒæ™¯ */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* Combo å‹•ç•« */
        @keyframes pop-in {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .combo-badge {
            animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake-element {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
    </style>
</head>
<body class="bg-amber-50 font-sans min-h-screen flex flex-col relative overflow-x-hidden">

    <!-- ç‘èŠ±å®¹å™¨ -->
    <div id="confetti-container"></div>

    <!-- é ‚éƒ¨å°èˆª -->
    <header class="bg-amber-500 text-white p-4 shadow-md sticky top-0 z-20 no-print transition-colors duration-500" id="main-header">
        <div class="max-w-4xl mx-auto flex flex-wrap justify-between items-center gap-2">
            <div class="flex items-center gap-2">
                <!-- åœ–ç¤º: BookOpen -->
                <svg class="w-6 h-6 hidden md:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <h1 class="text-lg md:text-xl font-bold">å­¸è¯èªå‘å‰èµ° Vol.2</h1>
            </div>
            
            <div class="flex items-center gap-2 text-sm font-bold ml-auto flex-wrap justify-end">
                <!-- ç·¨è¼¯æŒ‰éˆ• -->
                <button id="edit-mode-btn" class="bg-amber-700/50 hover:bg-amber-700 text-white px-3 py-1.5 rounded-full flex items-center gap-1 transition mr-1" title="æ–°å¢æˆ–ç·¨è¼¯èª²ç¨‹">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    <span class="hidden sm:inline">ç·¨è¼¯èª²ç¨‹</span>
                </button>

                <button onclick="window.print()" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-full flex items-center gap-1 transition mr-1" title="åˆ—å°æœ¬èª²å­¸ç¿’å–®">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                    <span class="hidden sm:inline">åˆ—å°å­¸ç¿’å–®</span>
                </button>

                <div class="bg-amber-600 px-3 py-1 rounded-full flex items-center gap-1 shadow-inner" title="ç›®å‰ç­‰ç´š">
                    <svg class="w-4 h-4 text-yellow-300 fill-current" viewBox="0 0 24 24"><path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5ZM19 19C19 19.6 18.6 20 18 20H6C5.4 20 5 19.6 5 19V17H19V19Z"></path></svg>
                    <span id="rank-display">ä¿®ç·´ä¸­</span>
                </div>
                <div class="bg-amber-600 px-3 py-1 rounded-full flex items-center gap-1 shadow-inner min-w-[70px] justify-center" title="èŠ±è²»æ™‚é–“">
                    <svg class="w-4 h-4 text-yellow-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span id="timer-display">00:00</span>
                </div>
            </div>
        </div>
    </header>

    <!-- éŠæˆ²ä¸»é«” -->
    <main id="app-container" class="max-w-3xl mx-auto w-full p-4 flex-1 flex flex-col z-10 no-print">
        
        <!-- é ‚éƒ¨æ§åˆ¶åˆ— (é¸èª²èˆ‡é€²åº¦) -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-4 gap-2">
            <div class="w-full md:w-auto flex-1">
                <select id="lesson-select" class="w-full md:w-auto bg-white border-2 border-amber-200 text-gray-700 py-2 px-4 rounded-xl font-medium focus:outline-none focus:border-amber-500 cursor-pointer hover:border-amber-300 transition">
                    <!-- ç”± JS å‹•æ…‹ç”Ÿæˆé¸é … -->
                </select>
            </div>
            
            <!-- é€²åº¦æ¢ -->
            <div class="w-full md:w-1/3 flex flex-col items-end">
                <div class="text-gray-500 font-bold text-sm mb-1" id="progress-text">é€²åº¦: 1 / 10</div>
                <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div id="progress-bar" class="bg-amber-500 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Combo é¡¯ç¤ºå€ -->
        <div id="combo-container" class="h-8 mb-2 flex justify-center items-center relative">
            <!-- JS å‹•æ…‹æ’å…¥ combo -->
        </div>

        <!-- éŠæˆ²å¡ç‰‡å€åŸŸ -->
        <div id="game-card" class="bg-white rounded-3xl shadow-xl border-4 border-amber-100 overflow-hidden flex flex-col flex-1 relative transition-all">
            
            <!-- é¡Œç›®æç¤ºå€ -->
            <div class="bg-amber-50 p-6 text-center border-b border-amber-100 relative">
                <div class="flex justify-center items-center gap-3 mb-2 flex-wrap">
                    <span class="bg-amber-200 text-amber-800 text-xs px-2 py-1 rounded-md font-bold flex items-center gap-1">
                        é‡çµ„å¥å­ (å¯æ‹–æ›³æ’åº)
                    </span>
                    <button id="tts-btn" class="bg-white p-2 rounded-full shadow-sm text-amber-500 hover:text-amber-700 hover:scale-110 transition active:scale-95" title="æœ—è®€å¥å­">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                    </button>
                </div>
            </div>

            <!-- ç­”é¡Œå€ (Answer Area) -->
            <div id="answer-area" class="p-4 md:p-8 min-h-[160px] bg-white flex flex-wrap content-start gap-2 justify-center transition-colors duration-300 noselect">
                <div id="empty-msg" class="text-gray-300 text-center w-full py-8 pointer-events-none select-none flex flex-col items-center">
                    <span class="text-4xl mb-2 opacity-20">ğŸ‘‡</span>
                    <span>é»æ“Šä¸‹æ–¹è©èªåŠ å…¥</span>
                </div>
                <!-- è©å½™å¡ç‰‡å°‡å‹•æ…‹æ’å…¥æ­¤è™• -->
            </div>

            <!-- ç‹€æ…‹å›é¥‹ -->
            <div id="feedback-area" class="transition-all duration-300 overflow-hidden max-h-0 py-0 text-center font-bold text-lg">
                <!-- ç­”å°/ç­”éŒ¯è¨Šæ¯ -->
            </div>

            <!-- é¸è©å€ (Source Area) -->
            <div id="source-area" class="bg-gray-50 p-4 md:p-8 border-t border-gray-100 min-h-[200px] flex-1 flex flex-wrap gap-3 justify-center content-start noselect">
                <!-- ä¾†æºè©å½™å¡ç‰‡ -->
            </div>

        </div>

        <!-- åº•éƒ¨æ§åˆ¶æŒ‰éˆ• -->
        <div class="mt-6 flex gap-4" id="controls">
            <button id="reset-btn" class="flex-1 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold hover:bg-gray-300 transition active:scale-95">é‡ç½®</button>
            <button id="check-btn" disabled class="flex-1 py-3 rounded-xl font-bold text-white bg-gray-300 cursor-not-allowed transition shadow-lg flex items-center justify-center gap-2 active:scale-95">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> æª¢æŸ¥ç­”æ¡ˆ
            </button>
            <button id="next-btn" class="hidden w-full py-4 bg-amber-500 text-white rounded-xl font-bold text-xl hover:bg-amber-600 transition shadow-lg flex items-center justify-center gap-2 animate-pulse active:scale-95">
                ä¸‹ä¸€é¡Œ <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            </button>
        </div>

        <!-- æ­å–œéé—œç•«é¢ (åˆå§‹éš±è—) -->
        <div id="completion-screen" class="hidden bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center border-4 border-amber-200 m-auto absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30">
            <div class="mx-auto mb-4">
                <svg class="w-24 h-24 text-yellow-500 mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">æ­å–œå®Œæˆï¼</h2>
            <p class="text-xl text-gray-600 mb-6">
                ä½ å®Œæˆäº† <span id="completed-lesson-title" class="text-amber-600 font-bold"></span>
            </p>
            
            <div class="flex flex-col gap-2 mb-8">
                <div class="text-2xl font-bold text-amber-500 flex items-center justify-center gap-2">
                    <svg class="w-8 h-8 text-yellow-300 fill-current" viewBox="0 0 24 24"><path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5ZM19 19C19 19.6 18.6 20 18 20H6C5.4 20 5 19.6 5 19V17H19V19Z"></path></svg>
                    ç­‰ç´š: <span id="final-rank"></span>
                </div>
                <div class="text-lg text-gray-500 flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    æ‰€èŠ±æ™‚é–“: <span id="final-time"></span>
                </div>
            </div>
            
            <div class="space-y-3">
                <button id="restart-btn" class="w-full py-3 bg-blue-500 text-white rounded-xl font-bold text-lg hover:bg-blue-600 transition shadow-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> å†ç©ä¸€æ¬¡
                </button>
                <button id="next-lesson-btn" class="w-full py-3 bg-amber-500 text-white rounded-xl font-bold text-lg hover:bg-amber-600 transition shadow-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg> ä¸‹ä¸€èª²
                </button>
            </div>
        </div>

    </main>

    <!-- ç·¨è¼¯å™¨æ¨¡æ…‹è¦–çª— -->
    <div id="editor-modal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4 no-print">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col overflow-hidden">
            <div class="bg-amber-500 text-white p-4 flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    èª²ç¨‹ç·¨è¼¯å™¨
                </h3>
                <button id="close-editor-btn" class="hover:bg-amber-600 p-1 rounded transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto flex-1">
                <!-- è³‡æ–™ç®¡ç† (åŒ¯å…¥/åŒ¯å‡º) -->
                <div class="mb-6 flex gap-3 border-b border-gray-200 pb-6">
                    <button id="export-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2 border border-gray-300">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        åŒ¯å‡ºèª²ç¨‹(å‚™ä»½)
                    </button>
                    <label for="import-file" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2 border border-gray-300 cursor-pointer">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        åŒ¯å…¥èª²ç¨‹
                        <input type="file" id="import-file" accept=".json" class="hidden">
                    </label>
                </div>

                <div class="mb-6 border-b border-gray-200 pb-6">
                    <h4 class="font-bold text-gray-700 mb-3 text-lg" id="editor-form-title">æ–°å¢/ç·¨è¼¯èª²ç¨‹</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">èª²ç¨‹æ¨™é¡Œ</label>
                            <input type="text" id="new-lesson-title" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„ç·´ç¿’èª²" class="w-full border-2 border-gray-300 rounded-lg p-2 focus:border-amber-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-1">
                                èª²ç¨‹å…§å®¹ <span class="text-xs text-amber-600 font-normal">(æ¯è¡Œä¸€å¥ï¼Œè©èªé–“è«‹ç”¨ " / " æˆ–ç©ºæ ¼åˆ†é–‹)</span>
                            </label>
                            <textarea id="new-lesson-content" rows="6" placeholder="ä¾‹å¦‚ï¼š&#10;ä»Šå¤© / å¤©æ°£ / çœŸå¥½ã€‚&#10;æˆ‘ / å–œæ­¡ / åƒ / è˜‹æœã€‚" class="w-full border-2 border-gray-300 rounded-lg p-2 focus:border-amber-500 focus:outline-none font-mono text-sm"></textarea>
                            
                            <!-- å³æ™‚é è¦½å€ -->
                            <div class="mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200 min-h-[60px]">
                                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase">å³æ™‚é è¦½ (Live Preview)</label>
                                <div id="editor-preview" class="space-y-2 text-sm text-gray-600">
                                    <span class="italic opacity-50">é è¦½å€...</span>
                                </div>
                            </div>
                        </div>
                        <button id="save-lesson-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            å„²å­˜èª²ç¨‹
                        </button>
                    </div>
                </div>

                <div>
                    <h4 class="font-bold text-gray-700 mb-3 text-lg">å·²å»ºç«‹çš„è‡ªè¨‚èª²ç¨‹</h4>
                    <div id="custom-lessons-list" class="space-y-2">
                        <p class="text-gray-400 text-sm text-center py-4">å°šç„¡è‡ªè¨‚èª²ç¨‹</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-amber-100 text-amber-800 text-center py-4 text-sm font-semibold no-print">
        Design by Sophia Wong
    </footer>

    <!-- åˆ—å°ç‰ˆ (é è¨­éš±è—ï¼Œåˆ—å°æ™‚é¡¯ç¤º) -->
    <div class="print-only bg-white text-black p-6 font-serif">
        <div class="border-b-2 border-black pb-2 mb-6">
            <div class="flex justify-between items-end mb-3">
                <div>
                    <h1 class="text-2xl font-bold">å¥å­é‡çµ„ç·´ç¿’</h1>
                    <h2 id="print-lesson-title" class="text-xl font-semibold mt-1"></h2>
                </div>
                <div class="text-lg mb-1">
                    <span>å§“å (Name): ____________________</span>
                </div>
            </div>
            <p class="text-base font-bold">èªªæ˜ï¼šè«‹å°‡ä¸‹æ–¹çš„è©èªé‡çµ„æˆæ­£ç¢ºçš„å¥å­ï¼Œä¸¦åŠ ä¸Šæ¨™é»ç¬¦è™Ÿå¯«åœ¨æ©«ç·šä¸Šã€‚</p>
        </div>

        <div id="print-worksheet-content" class="space-y-6">
            <!-- JS ç”Ÿæˆ -->
        </div>

        <div class="mt-8 text-center text-xs text-gray-400">
            <p>Design by Sophia Wong</p>
        </div>
    </div>

    <!-- Javascript Logic -->
    <script>
        // é è¨­è³‡æ–™
        const DEFAULT_GAME_DATA = [
            {
                lessonId: 1,
                lessonTitle: "ç¬¬ä¸€èª²ï¼šæ–°åŒå­¸",
                sentences: [
                    { id: "L1-S1", chinese: "ä»Šå¤©ï¼Œæˆ‘å€‘æœ‰å…©å€‹æ–°åŒå­¸ã€‚", segments: ["ä»Šå¤©", "ï¼Œ", "æˆ‘å€‘", "æœ‰", "å…©å€‹", "æ–°åŒå­¸", "ã€‚"] },
                    { id: "L1-S2", chinese: "ç¾åœ¨è«‹ä»–å€‘ä»‹ç´¹è‡ªå·±ã€‚", segments: ["ç¾åœ¨", "è«‹", "ä»–å€‘", "ä»‹ç´¹", "è‡ªå·±", "ã€‚"] },
                    { id: "L1-S3", chinese: "å¤§å®¶å¥½ï¼Œæˆ‘å«æ–¹å‹æœ‹ï¼Œä»Šå¹´å…«æ­²ã€‚", segments: ["å¤§å®¶å¥½", "ï¼Œ", "æˆ‘å«", "æ–¹å‹æœ‹", "ï¼Œ", "ä»Šå¹´", "å…«æ­²", "ã€‚"] },
                    { id: "L1-S4", chinese: "æˆ‘æœ€å–œæ­¡è·Ÿçˆ¸çˆ¸ä¸€èµ·æ¸¸æ³³ã€‚", segments: ["æˆ‘", "æœ€å–œæ­¡", "è·Ÿçˆ¸çˆ¸", "ä¸€èµ·", "æ¸¸æ³³", "ã€‚"] },
                    { id: "L1-S5", chinese: "å¤§å®¶å¥½ï¼Œæˆ‘å«å¼µè‰ï¼Œä»Šå¹´ä¸ƒæ­²ã€‚", segments: ["å¤§å®¶å¥½", "ï¼Œ", "æˆ‘å«", "å¼µè‰", "ï¼Œ", "ä»Šå¹´", "ä¸ƒæ­²", "ã€‚"] },
                    { id: "L1-S6", chinese: "æˆ‘æ¯”è¼ƒå–œæ­¡çœ‹æ›¸ã€‚", segments: ["æˆ‘", "æ¯”è¼ƒ", "å–œæ­¡", "çœ‹æ›¸", "ã€‚"] },
                    { id: "L1-S7", chinese: "ä½ å€‘å¥½ï¼Œæˆ‘å«æå¤§æ–‡ã€‚", segments: ["ä½ å€‘å¥½", "ï¼Œ", "æˆ‘å«", "æå¤§æ–‡", "ã€‚"] },
                    { id: "L1-S8", chinese: "å¾ˆé«˜èˆˆèªè­˜ä½ å€‘ã€‚", segments: ["å¾ˆé«˜èˆˆ", "èªè­˜", "ä½ å€‘", "ã€‚"] },
                    { id: "L1-S9", chinese: "æ­¡è¿ä½ å€‘ä¾†ä¸­æ–‡å­¸æ ¡å­¸è¯èªã€‚", segments: ["æ­¡è¿", "ä½ å€‘", "ä¾†", "ä¸­æ–‡å­¸æ ¡", "å­¸è¯èª", "ã€‚"] }
                ]
            },
            {
                lessonId: 2,
                lessonTitle: "ç¬¬äºŒèª²ï¼šæˆ‘çˆ¸çˆ¸åšç”Ÿæ„",
                sentences: [
                    { id: "L2-S1", chinese: "å¼µè‰ï¼Œç…§ç‰‡è£¡é¢çš„äººæ˜¯èª°ï¼Ÿ", segments: ["å¼µè‰", "ï¼Œ", "ç…§ç‰‡", "è£¡é¢", "çš„", "äºº", "æ˜¯", "èª°", "ï¼Ÿ"] },
                    { id: "L2-S2", chinese: "å·¦é‚Šæ˜¯æˆ‘å¤–å…¬ï¼Œä»–ä»¥å‰æ˜¯é†«ç”Ÿã€‚", segments: ["å·¦é‚Š", "æ˜¯", "æˆ‘å¤–å…¬", "ï¼Œ", "ä»–", "ä»¥å‰", "æ˜¯", "é†«ç”Ÿ", "ã€‚"] },
                    { id: "L2-S3", chinese: "å³é‚Šæ˜¯æˆ‘å¤–å©†ã€‚", segments: ["å³é‚Š", "æ˜¯", "æˆ‘å¤–å©†", "ã€‚"] },
                    { id: "L2-S4", chinese: "ä½ çˆ¸çˆ¸åª½åª½åšä»€éº¼å·¥ä½œï¼Ÿ", segments: ["ä½ ", "çˆ¸çˆ¸åª½åª½", "åš", "ä»€éº¼", "å·¥ä½œ", "ï¼Ÿ"] },
                    { id: "L2-S5", chinese: "æˆ‘çˆ¸çˆ¸åšç”Ÿæ„ï¼Œæˆ‘åª½åª½å¹«ä»–ã€‚", segments: ["æˆ‘çˆ¸çˆ¸", "åšç”Ÿæ„", "ï¼Œ", "æˆ‘åª½åª½", "å¹«ä»–", "ã€‚"] },
                    { id: "L2-S6", chinese: "ä½ çˆ¸çˆ¸åª½åª½å‘¢?", segments: ["ä½ ", "çˆ¸çˆ¸åª½åª½", "å‘¢", "?",] },
                    { id: "L2-S7", chinese: "æˆ‘çˆ¸çˆ¸åœ¨é›»è…¦å…¬å¸ä¸Šç­ã€‚", segments: ["æˆ‘çˆ¸çˆ¸", "åœ¨", "é›»è…¦å…¬å¸", "ä¸Šç­", "ã€‚"] },
                    { id: "L2-S8", chinese: "æˆ‘åª½åª½åœ¨éŠ€è¡Œå·¥ä½œã€‚", segments: ["æˆ‘åª½åª½", "åœ¨", "éŠ€è¡Œ", "å·¥ä½œ", "ã€‚"] },
                    { id: "L2-S9", chinese: "ä½ ä»¥å¾Œæƒ³åšä»€éº¼ï¼Ÿ", segments: ["ä½ ", "ä»¥å¾Œ", "æƒ³", "åš", "ä»€éº¼", "ï¼Ÿ"] },
                    { id: "L2-S10", chinese: "æˆ‘ä»¥å¾Œæƒ³è·Ÿçˆ¸çˆ¸ä¸€æ¨£ã€‚", segments: ["æˆ‘", "ä»¥å¾Œ", "æƒ³", "è·Ÿçˆ¸çˆ¸", "ä¸€æ¨£", "ã€‚"] }
                ]
            },
            {
                lessonId: 3,
                lessonTitle: "ç¬¬ä¸‰èª²ï¼šå»è¶…ç´šå¸‚å ´",
                sentences: [
                    { id: "L3-S1", chinese: "åª½åª½ï¼Œä½ è¦å»å“ªè£¡ï¼Ÿ", segments: ["åª½åª½", "ï¼Œ", "ä½ ", "è¦å»", "å“ªè£¡", "ï¼Ÿ"] },
                    { id: "L3-S2", chinese: "æˆ‘è¦å»é™„è¿‘çš„è¶…ç´šå¸‚å ´è²·æ±è¥¿ã€‚", segments: ["æˆ‘è¦å»", "é™„è¿‘çš„", "è¶…ç´šå¸‚å ´", "è²·æ±è¥¿", "ã€‚"] },
                    { id: "L3-S3", chinese: "ä½ è¦è·Ÿæˆ‘ä¸€èµ·å»å—ï¼Ÿ", segments: ["ä½ è¦", "è·Ÿæˆ‘", "ä¸€èµ·å»", "å—", "ï¼Ÿ"] },
                    { id: "L3-S4", chinese: "è¦ï¼Œæˆ‘æƒ³å»è²·å·§å…‹åŠ›å†°æ·‡æ·‹ã€‚", segments: ["è¦", "ï¼Œ", "æˆ‘æƒ³å»", "è²·", "å·§å…‹åŠ›", "å†°æ·‡æ·‹", "ã€‚"] },
                    { id: "L3-S5", chinese: "ä½ ä»Šå¤©è¦è²·ä»€éº¼ï¼Ÿ", segments: ["ä½ ", "ä»Šå¤©", "è¦è²·", "ä»€éº¼", "ï¼Ÿ"] },
                    { id: "L3-S6", chinese: "æˆ‘ä»Šå¤©è¦è²·é­šã€ç‰›è‚‰ã€é’èœï¼Œé‚„è¦è²·ç±³ã€‚", segments: ["æˆ‘", "ä»Šå¤©", "è¦è²·", "é­š", "ã€", "ç‰›è‚‰", "ã€", "é’èœ", "ï¼Œ", "é‚„è¦", "è²·ç±³", "ã€‚"] },
                    { id: "L3-S8", chinese: "æˆ‘ä¹Ÿå¯ä»¥è²·ç³–æœå—ï¼Ÿ", segments: ["æˆ‘", "ä¹Ÿå¯ä»¥", "è²·", "ç³–æœ", "å—", "ï¼Ÿ"] },
                    { id: "L3-S9", chinese: "æˆ‘å€‘å»çœ‹ä¸€ä¸‹å§ï¼", segments: ["æˆ‘å€‘", "å»", "çœ‹ä¸€ä¸‹", "å§", "ï¼"] }
                ]
            },
            {
                lessonId: 4,
                lessonTitle: "ç¬¬å››èª²ï¼šæˆ‘æƒ³åƒæ¼¢å ¡",
                sentences: [
                    { id: "L4-S1", chinese: "æˆ‘æƒ³åƒæ¼¢å ¡è·Ÿè–¯æ¢ã€‚", segments: ["æˆ‘æƒ³åƒ", "æ¼¢å ¡", "è·Ÿ", "è–¯æ¢", "ã€‚"] },
                    { id: "L4-S2", chinese: "æˆ‘å€‘å¯ä¸å¯ä»¥å‡ºå»åƒï¼Ÿ", segments: ["æˆ‘å€‘", "å¯ä¸å¯ä»¥", "å‡ºå»åƒ", "ï¼Ÿ"] },
                    { id: "L4-S3", chinese: "ä»Šå¤©å…ˆåœ¨å®¶åƒã€‚", segments: ["ä»Šå¤©", "å…ˆåœ¨", "å®¶åƒ", "ã€‚"] },
                    { id: "L4-S4", chinese: "é€±æœ«å†å‡ºå»åƒå§ï¼", segments: ["é€±æœ«", "å†", "å‡ºå»åƒ", "å§", "ï¼"] },
                    { id: "L4-S5", chinese: "ä»Šå¤©æ™šé¤æƒ³åƒä»€éº¼ï¼Ÿ", segments: ["ä»Šå¤©", "æ™šé¤", "æƒ³åƒ", "ä»€éº¼", "ï¼Ÿ"] },
                    { id: "L4-S6", chinese: "æˆ‘æƒ³åƒéºµã€‚æ–‡æ–‡ï¼Œä½ å‘¢ï¼Ÿ", segments: ["æˆ‘æƒ³", "åƒéºµ", "ã€‚", "æ–‡æ–‡", "ï¼Œ", "ä½ å‘¢", "ï¼Ÿ"] },
                    { id: "L4-S7", chinese: "æˆ‘æƒ³åƒè›‹ç‚’é£¯ï¼Œæœ‰æ¹¯å—ï¼Ÿ", segments: ["æˆ‘æƒ³åƒ", "è›‹ç‚’é£¯", "ï¼Œ", "æœ‰", "æ¹¯", "å—", "ï¼Ÿ"] },
                    { id: "L4-S8", chinese: "æˆ‘å·²ç¶“åšäº†ç‰ç±³æ¹¯ã€‚", segments: ["æˆ‘", "å·²ç¶“", "åšäº†", "ç‰ç±³æ¹¯", "ã€‚"] },
                    { id: "L4-S9", chinese: "åª½ï¼Œæˆ‘ç¾åœ¨å¾ˆé¤“ã€‚", segments: ["åª½", "ï¼Œ", "æˆ‘", "ç¾åœ¨", "å¾ˆé¤“", "ã€‚"] },
                    { id: "L4-S10", chinese: "æˆ‘æƒ³å¿«é»åƒæ™šé£¯ï¼Œå¥½å—ï¼Ÿ", segments: ["æˆ‘", "æƒ³", "å¿«é»", "åƒæ™šé£¯", "ï¼Œ", "å¥½å—", "ï¼Ÿ"] }
                ]
            },
            {
                lessonId: 5,
                lessonTitle: "ç¬¬äº”èª²ï¼šæ˜¥å¤©å¿«åˆ°äº†",
                sentences: [
                    { id: "L5-S1", chinese: "ä½ çœ‹ï¼æ¨¹è‘‰è®Šé»ƒäº†ï¼Œç§‹å¤©å¿«åˆ°äº†ã€‚", segments: ["ä½ çœ‹", "ï¼", "æ¨¹è‘‰", "è®Šé»ƒäº†", "ï¼Œ", "ç§‹å¤©", "å¿«åˆ°äº†", "ã€‚"] },
                    { id: "L5-S3", chinese: "å¯æ˜¯è‰é‚„æ˜¯ç¶ è‰²çš„ã€‚", segments: ["å¯æ˜¯", "è‰", "é‚„æ˜¯", "ç¶ è‰²çš„", "ã€‚"] },
                    { id: "L5-S4", chinese: "ç§‹å¤©å¤©æ°£å¾ˆå¥½ã€‚æˆ‘è¦ºå¾—å¾ˆèˆ’æœã€‚", segments: ["ç§‹å¤©", "å¤©æ°£", "å¾ˆå¥½", "ã€‚", "æˆ‘", "è¦ºå¾—", "å¾ˆèˆ’æœ", "ã€‚"] },
                    { id: "L5-S6", chinese: "æ˜¥å¤©ä¹Ÿä¸éŒ¯ã€‚", segments: ["æ˜¥å¤©", "ä¹Ÿä¸éŒ¯", "ã€‚"] },
                    { id: "L5-S7", chinese: "æ˜¥å¤©çš„æ™‚å€™ï¼Œæˆ‘å€‘å®¶é™¢å­æœ‰å¾ˆå¤šé¡è‰²çš„èŠ±ã€‚", segments: ["æ˜¥å¤©çš„", "æ™‚å€™", "ï¼Œ", "æˆ‘å€‘å®¶", "é™¢å­", "æœ‰", "å¾ˆå¤š", "é¡è‰²çš„", "èŠ±", "ã€‚"] },
                    { id: "L5-S8", chinese: "ç´…è‰²çš„ã€ç™½è‰²çš„éƒ½æœ‰ã€‚", segments: ["ç´…è‰²çš„", "ã€", "ç™½è‰²çš„", "éƒ½æœ‰", "ã€‚"] },
                    { id: "L5-S9", chinese: "æˆ‘è¦ºå¾—ç´…è‰²çš„èŠ±æœ€æ¼‚äº®ã€‚", segments: ["æˆ‘", "è¦ºå¾—", "ç´…è‰²çš„", "èŠ±", "æœ€æ¼‚äº®", "ã€‚"] }
                ]
            },
            {
                lessonId: 6,
                lessonTitle: "ç¬¬å…­èª²ï¼šè¾²æ›†æ–°å¹´",
                sentences: [
                    { id: "L6-S1", chinese: "è€å¸«èªªè¾²æ›†æ–°å¹´å¿«åˆ°äº†ã€‚", segments: ["è€å¸«èªª", "è¾²æ›†æ–°å¹´", "å¿«åˆ°äº†", "ã€‚"] },
                    { id: "L6-S2", chinese: "å°ï¼Œä¸‹å€‹æ˜ŸæœŸäº”æ˜¯è¾²æ›†æ–°å¹´ã€‚", segments: ["å°", "ï¼Œ", "ä¸‹å€‹", "æ˜ŸæœŸäº”", "æ˜¯", "è¾²æ›†æ–°å¹´", "ã€‚"] },
                    { id: "L6-S3", chinese: "åª½åª½æœƒå»è¯äººè¶…å¸‚è²·å¹´ç³•å—ï¼Ÿ", segments: ["åª½åª½", "æœƒå»", "è¯äººè¶…å¸‚", "è²·", "å¹´ç³•", "å—", "ï¼Ÿ"] },
                    { id: "L6-S4", chinese: "æœƒï¼Œé‚£å¤©æˆ‘å€‘é‚„è¦çµ¦çˆºçˆºå¥¶å¥¶æ‹œå¹´ã€‚", segments: ["æœƒ", "ï¼Œ", "é‚£å¤©", "æˆ‘å€‘", "é‚„è¦çµ¦", "çˆºçˆºå¥¶å¥¶", "æ‹œå¹´", "ã€‚"] },
                    { id: "L6-S5", chinese: "å¤ªå¥½äº†ï¼Œçˆºçˆºæ¯å¹´éƒ½æœƒçµ¦æˆ‘ç´…åŒ…ã€‚", segments: ["å¤ªå¥½äº†", "ï¼Œ", "çˆºçˆº", "æ¯å¹´", "éƒ½æœƒ", "çµ¦æˆ‘", "ç´…åŒ…", "ã€‚"] },
                    { id: "L6-S6", chinese: "å¦‚æœåœ¨è‡ºç£ï¼Œæˆ‘å€‘é‚„æœƒè²¼æ˜¥è¯ã€æ”¾é­ç‚®ã€‚", segments: ["å¦‚æœ", "åœ¨è‡ºç£", "ï¼Œ", "æˆ‘å€‘", "é‚„æœƒ", "è²¼æ˜¥è¯", "ã€", "æ”¾é­ç‚®", "ã€‚"] }
                ]
            },
            {
                lessonId: 7,
                lessonTitle: "ç¬¬ä¸ƒèª²ï¼šæ—©ä¸€é»ç¡è¦º",
                sentences: [
                    { id: "L7-S1", chinese: "è©²èµ·åºŠäº†ï¼ä¾†ä¸åŠäº†ï¼", segments: ["è©²", "èµ·åºŠäº†", "ï¼", "ä¾†ä¸åŠäº†", "ï¼"] },
                    { id: "L7-S2", chinese: "æˆ‘å¾ˆç´¯ï¼Œé‚„æƒ³ç¡è¦ºã€‚", segments: ["æˆ‘å¾ˆç´¯", "ï¼Œ", "é‚„æƒ³", "ç¡è¦º", "ã€‚"] },
                    { id: "L7-S3", chinese: "ä»Šå¤©æ™šä¸Šæ—©ä¸€é»ç¡ã€‚", segments: ["ä»Šå¤©æ™šä¸Š", "æ—©ä¸€é»","ç¡", "ã€‚"] },
                    { id: "L7-S4", chinese: "ç¾åœ¨è¶•å¿«å»åˆ·ç‰™ã€æ´—æ¾¡ã€‚", segments: ["ç¾åœ¨", "è¶•å¿«å»", "åˆ·ç‰™", "ã€", "æ´—æ¾¡", "ã€‚"] },
                    { id: "L7-S5", chinese: "æˆ‘æ˜¨å¤©æ™šä¸Šæ´—éæ¾¡äº†ã€‚", segments: ["æˆ‘", "æ˜¨å¤©æ™šä¸Š", "æ´—éæ¾¡", "äº†", "ã€‚"] },
                    { id: "L7-S6", chinese: "é‚„æœ‰ï¼Œåˆ¥å¿˜äº†ç”¨è‚¥çš‚æ´—è‡‰ã€‚", segments: ["é‚„æœ‰", "ï¼Œ", "åˆ¥å¿˜äº†", "ç”¨", "è‚¥çš‚", "æ´—è‡‰", "ã€‚"] },
                    { id: "L7-S7", chinese: "æˆ‘çŸ¥é“äº†ï¼Œè¦æ´—ä¹¾æ·¨ã€‚", segments: ["æˆ‘çŸ¥é“äº†", "ï¼Œ", "è¦", "æ´—ä¹¾æ·¨", "ã€‚"] }
                ]
            },
            {
                lessonId: 8,
                lessonTitle: "ç¬¬å…«èª²ï¼šæˆ‘çš„å¯µç‰©",
                sentences: [
                    { id: "L8-S1", chinese: "æ˜¨å¤©æˆ‘çˆ¸çˆ¸çš„æœ‹å‹é€çµ¦æˆ‘ä¸€éš»ç‹—ã€‚", segments: ["æ˜¨å¤©", "æˆ‘çˆ¸çˆ¸çš„", "æœ‹å‹", "é€çµ¦æˆ‘", "ä¸€éš»ç‹—", "ã€‚"] },
                    { id: "L8-S2", chinese: "ä½ å€‘å®¶æœ‰å¯µç‰©å—ï¼Ÿ", segments: ["ä½ å€‘å®¶", "æœ‰", "å¯µç‰©", "å—", "ï¼Ÿ"] },
                    { id: "L8-S3", chinese: "æœ‰ï¼Œæˆ‘å®¶æœ‰å…©éš»ç‹—ã€‚", segments: ["æœ‰", "ï¼Œ", "æˆ‘å®¶", "æœ‰", "å…©éš»ç‹—", "ã€‚"] },
                    { id: "L8-S4", chinese: "æˆ‘æ¯å¤©éƒ½å¸¶ç‰ å€‘å»æ•£æ­¥ã€‚", segments: ["æˆ‘", "æ¯å¤©", "éƒ½å¸¶", "ç‰ å€‘", "å»", "æ•£æ­¥", "ã€‚"] },
                    { id: "L8-S5", chinese: "å¼µè‰ï¼Œä½ é¤Šéç‹—å—ï¼Ÿ", segments: ["å¼µè‰", "ï¼Œ", "ä½ ", "é¤Šé", "ç‹—", "å—", "ï¼Ÿ"] },
                    { id: "L8-S6", chinese: "æˆ‘æ²’é¤Šéç‹—ï¼Œæˆ‘å»å¹´é¤Šäº†ä¸€éš»è²“ã€‚", segments: ["æˆ‘", "æ²’é¤Šé", "ç‹—", "ï¼Œ", "æˆ‘å»å¹´", "é¤Šäº†", "ä¸€éš»è²“", "ã€‚"] },
                    { id: "L8-S7", chinese: "å¯æ˜¯ï¼Œä¸Šå€‹æœˆä¸è¦‹äº†ã€‚", segments: ["å¯æ˜¯", "ï¼Œ","ä¸Šå€‹æœˆ", "ä¸è¦‹äº†", "ã€‚"] },
                    { id: "L8-S8", chinese: "æˆ‘ä¹Ÿé¤Šéè²“ï¼Œéå¸¸å¯æ„›ã€‚", segments: ["æˆ‘ä¹Ÿ", "é¤Šéè²“", "ï¼Œ", "éå¸¸å¯æ„›", "ã€‚"] },
                    { id: "L8-S9", chinese: "æˆ‘æ¯å¤©éƒ½é¤µç‰ ã€‚", segments: ["æˆ‘", "æ¯å¤©", "éƒ½", "é¤µç‰ ", "ã€‚"] },
                    { id: "L8-S10", chinese: "ä»¥å¾Œæˆ‘æƒ³é¤Šä¸€éš»å…”å­ã€‚", segments: ["ä»¥å¾Œ", "æˆ‘æƒ³", "é¤Š", "ä¸€éš»", "å…”å­", "ã€‚"] }
                ]
            },
            {
                lessonId: 9,
                lessonTitle: "ç¬¬ä¹èª²ï¼šéŸ³æ¨‚æ•™å®¤åœ¨åŒ—æ–¹",
                sentences: [
                    { id: "L9-S1", chinese: "æ±æ˜ï¼Œé€™æ˜¯ä»€éº¼ï¼Ÿ", segments: ["æ±æ˜", "ï¼Œ", "é€™æ˜¯", "ä»€éº¼", "ï¼Ÿ"] },
                    { id: "L9-S2", chinese: "æŒ‡å—é‡ï¼Œä¹Ÿå«æŒ‡åŒ—é‡ã€‚", segments: ["æŒ‡å—é‡", "ï¼Œ", "ä¹Ÿå«", "æŒ‡åŒ—é‡", "ã€‚"] },
                    { id: "L9-S3", chinese: "å®ƒå‘Šè¨´æˆ‘å€‘å—æ–¹å’ŒåŒ—æ–¹åœ¨å“ªè£¡ã€‚", segments: ["å®ƒ", "å‘Šè¨´", "æˆ‘å€‘", "å—æ–¹", "å’Œ", "åŒ—æ–¹", "åœ¨å“ªè£¡", "ã€‚"] },
                    { id: "L9-S4", chinese: "éŸ³æ¨‚æ•™å®¤æ˜¯ä»€éº¼æ–¹å‘ï¼Ÿ", segments: ["éŸ³æ¨‚æ•™å®¤", "æ˜¯", "ä»€éº¼", "æ–¹å‘", "ï¼Ÿ"] },
                    { id: "L9-S5", chinese: "éŸ³æ¨‚æ•™å®¤åœ¨åŒ—æ–¹ï¼Œæ ¡é–€å£åœ¨å—æ–¹ã€‚", segments: ["éŸ³æ¨‚æ•™å®¤", "åœ¨åŒ—æ–¹", "ï¼Œ", "æ ¡é–€å£", "åœ¨å—æ–¹", "ã€‚"] },
                    { id: "L9-S6", chinese: "è¶³çƒå ´åœ¨æ±æ–¹ï¼Œé‚„æ˜¯è¥¿æ–¹ï¼Ÿ", segments: ["è¶³çƒå ´", "åœ¨æ±æ–¹", "ï¼Œ", "é‚„æ˜¯", "è¥¿æ–¹", "ï¼Ÿ"] },
                    { id: "L9-S7", chinese: "å› ç‚ºéŸ³æ¨‚æ•™å®¤åœ¨åŒ—æ–¹ï¼Œæ‰€ä»¥è¶³çƒå ´åœ¨æ±æ–¹ã€‚", segments: ["å› ç‚º", "éŸ³æ¨‚æ•™å®¤", "åœ¨åŒ—æ–¹", "ï¼Œ", "æ‰€ä»¥", "è¶³çƒå ´", "åœ¨æ±æ–¹", "ã€‚"] }
                ]
            },
            {
                lessonId: 10,
                lessonTitle: "ç¬¬åèª²ï¼šå¤–å…¬ã€å¤–å©†ä½åœ¨è‡ºç£",
                sentences: [
                    { id: "L10-S1", chinese: "æš‘å‡çš„æ™‚å€™ï¼Œæˆ‘æœƒå»è‡ºç£çœ‹å¤–å…¬ã€å¤–å©†ã€‚", segments: ["æš‘å‡çš„", "æ™‚å€™", "ï¼Œ", "æˆ‘æœƒå»", "è‡ºç£", "çœ‹", "å¤–å…¬", "ã€", "å¤–å©†", "ã€‚"] },
                    { id: "L10-S3", chinese: "ä½ å¤–å…¬ã€å¤–å©†å®¶åœ¨å“ªè£¡ï¼Ÿ", segments: ["ä½ ", "å¤–å…¬", "ã€", "å¤–å©†å®¶", "åœ¨å“ªè£¡", "ï¼Ÿ"] },
                    { id: "L10-S4", chinese: "ä»–å€‘æœ¬ä¾†ä½åœ¨è‡ºåŒ—ã€‚", segments: ["ä»–å€‘", "æœ¬ä¾†", "ä½åœ¨", "è‡ºåŒ—", "ã€‚"] },
                    { id: "L10-S5", chinese: "é€€ä¼‘ä»¥å¾Œï¼Œè·Ÿæˆ‘çš„èˆ…èˆ…ä½åœ¨è‡ºå—ã€‚", segments: ["é€€ä¼‘", "ä»¥å¾Œ", "ï¼Œ", "è·Ÿæˆ‘çš„", "èˆ…èˆ…", "ä½åœ¨", "è‡ºå—", "ã€‚"] },
                    { id: "L10-S6", chinese: "ä½ å€‘æ¯å¹´éƒ½å»çœ‹å¤–å…¬å¤–å©†å—ï¼Ÿ", segments: ["ä½ å€‘", "æ¯å¹´", "éƒ½å»", "çœ‹", "å¤–å…¬å¤–å©†", "å—", "ï¼Ÿ"] },
                    { id: "L10-S7", chinese: "æˆ‘å€‘æ¯å¹´éƒ½å»çœ‹ä»–å€‘ä¸€æ¬¡ã€‚", segments: ["æˆ‘å€‘", "æ¯å¹´", "éƒ½å»", "çœ‹ä»–å€‘", "ä¸€æ¬¡", "ã€‚"] },
                    { id: "L10-S8", chinese: "ä½ å¤–å…¬å¤–å©†ä½åœ¨å“ªè£¡ï¼Ÿ", segments: ["ä½ ", "å¤–å…¬å¤–å©†", "ä½åœ¨", "å“ªè£¡", "ï¼Ÿ"] },
                    { id: "L10-S9", chinese: "æˆ‘å¤–å…¬ã€å¤–å©†ç¾åœ¨ä½åœ¨ç´ç´„ã€‚", segments: ["æˆ‘", "å¤–å…¬", "ã€", "å¤–å©†", "ç¾åœ¨", "ä½åœ¨", "ç´ç´„", "ã€‚"] },
                    { id: "L10-S10", chinese: "ä»–å€‘ä¸‹å€‹æœˆæœƒä¾†çœ‹æˆ‘å€‘ã€‚", segments: ["ä»–å€‘", "ä¸‹å€‹æœˆ", "æœƒä¾†", "çœ‹æˆ‘å€‘", "ã€‚"] },
                    { id: "L10-S11", chinese: "æˆ‘å¤–å…¬ã€å¤–å©†å–œæ­¡æ—…è¡Œï¼Œå¸¸å¸¸ä¾†çœ‹æˆ‘å€‘ã€‚", segments: ["æˆ‘", "å¤–å…¬", "ã€", "å¤–å©†", "å–œæ­¡", "æ—…è¡Œ", "ï¼Œ", "å¸¸å¸¸", "ä¾†", "çœ‹æˆ‘å€‘", "ã€‚"] },
                    { id: "L10-S12", chinese: "æˆ‘å¤–å…¬ã€å¤–å©†ä¹Ÿå¸¸å»æ³•åœ‹çœ‹é˜¿å§¨ã€‚", segments: ["æˆ‘", "å¤–å…¬", "ã€", "å¤–å©†","ä¹Ÿå¸¸å»", "æ³•åœ‹", "çœ‹é˜¿å§¨", "ã€‚"] }
                ]
            },
            {
                lessonId: 11,
                lessonTitle: "ç¬¬åä¸€èª²ï¼šå»å‹•ç‰©åœ’",
                sentences: [
                    { id: "L11-S1", chinese: "ä¸‹å€‹æ˜ŸæœŸäº”ï¼Œå­¸æ ¡è¦å¸¶æˆ‘å€‘å»å‹•ç‰©åœ’ç©ã€‚", segments: ["ä¸‹å€‹", "æ˜ŸæœŸäº”", "ï¼Œ", "å­¸æ ¡", "è¦å¸¶", "æˆ‘å€‘", "å»", "å‹•ç‰©åœ’", "ç©", "ã€‚"] },
                    { id: "L11-S2", chinese: "å¤ªå¥½äº†ï¼ä½ å¯ä»¥çœ‹åˆ°ä½ å–œæ­¡çš„å¤§è±¡å’Œè€è™ã€‚", segments: ["å¤ªå¥½äº†", "ï¼", "ä½ å¯ä»¥", "çœ‹åˆ°", "ä½ å–œæ­¡çš„", "å¤§è±¡", "å’Œ", "è€è™", "ã€‚"] },
                    { id: "L11-S3", chinese: "é€™ä¸€æ¬¡æˆ‘å¸Œæœ›å¯ä»¥çœ‹åˆ°ç†Šè²“å’ŒçŒ´å­ã€‚", segments: ["é€™ä¸€æ¬¡", "æˆ‘å¸Œæœ›", "å¯ä»¥", "çœ‹åˆ°", "ç†Šè²“", "å’Œ", "çŒ´å­", "ã€‚"] },
                    { id: "L11-S4", chinese: "å°ï¼Œä»¥å‰æˆ‘å»çš„æ™‚å€™ï¼Œå‹•ç‰©åœ’æ²’æœ‰ç†Šè²“ã€‚", segments: ["å°", "ï¼Œ", "ä»¥å‰", "æˆ‘å»", "çš„æ™‚å€™", "ï¼Œ", "å‹•ç‰©åœ’", "æ²’æœ‰", "ç†Šè²“", "ã€‚"] },
                    { id: "L11-S5", chinese: "ç¾åœ¨ä¸ä½†æœ‰ç†Šè²“ï¼Œé‚„æœ‰ä¼éµã€‚", segments: ["ç¾åœ¨", "ä¸ä½†æœ‰", "ç†Šè²“", "ï¼Œ", "é‚„æœ‰", "ä¼éµ", "ã€‚"] },
                    { id: "L11-S6", chinese: "æˆ‘è¦ºå¾—ç†Šè²“èƒ–èƒ–çš„ï¼ŒçœŸå¯æ„›ï¼", segments: ["æˆ‘", "è¦ºå¾—", "ç†Šè²“", "èƒ–èƒ–çš„", "ï¼Œ", "çœŸå¯æ„›", "ï¼"] },
                    { id: "L11-S7", chinese: "æˆ‘å–œæ­¡é•·é ¸é¹¿ï¼Œè„–å­é•·é•·çš„ã€‚", segments: ["æˆ‘å–œæ­¡", "é•·é ¸é¹¿", "ï¼Œ", "è„–å­", "é•·é•·çš„", "ã€‚"] }
                ]
            },
            {
                lessonId: 12,
                lessonTitle: "ç¬¬åäºŒèª²ï¼šæ‰“ç¶²è·¯é›»è©±",
                sentences: [
                    { id: "L12-S1", chinese: "å¤§æ–‡ï¼Œæˆ‘ç¾åœ¨è¦ç”¨ç¶²è·¯çµ¦å§‘å§‘æ‰“é›»è©±ã€‚", segments: ["å¤§æ–‡", "ï¼Œ", "æˆ‘", "ç¾åœ¨", "è¦ç”¨", "ç¶²è·¯", "çµ¦å§‘å§‘", "æ‰“é›»è©±", "ã€‚"] },
                    { id: "L12-S2", chinese: "å¯ä»¥çœ‹åˆ°å§‘å§‘å—ï¼Ÿ", segments: ["å¯ä»¥", "çœ‹åˆ°", "å§‘å§‘", "å—", "ï¼Ÿ"] },
                    { id: "L12-S3", chinese: "æˆ‘å¾ˆä¹…æ²’è·Ÿå§‘å§‘èªªè©±äº†ã€‚", segments: ["æˆ‘", "å¾ˆä¹…", "æ²’è·Ÿ", "å§‘å§‘", "èªªè©±äº†", "ã€‚"] },
                    { id: "L12-S4", chinese: "å¯ä»¥çœ‹åˆ°å¥¹çš„å½±åƒï¼Œå¿«ä¸€é»éä¾†ã€‚", segments: ["å¯ä»¥", "çœ‹åˆ°", "å¥¹çš„", "å½±åƒ", "ï¼Œ", "å¿«ä¸€é»", "éä¾†", "ã€‚"] },
                    { id: "L12-S5", chinese: "å¤§æ–‡ï¼Œä½ çœ‹èµ·ä¾†ç˜¦äº†ã€‚", segments: ["å¤§æ–‡", "ï¼Œ", "ä½ ", "çœ‹èµ·ä¾†", "ç˜¦äº†", "ã€‚"] },
                    { id: "L12-S6", chinese: "æˆ‘æ²’ç˜¦ï¼Œæˆ‘é•·é«˜äº†ã€‚", segments: ["æˆ‘æ²’ç˜¦", "ï¼Œ", "æˆ‘", "é•·é«˜äº†", "ã€‚"] },
                    { id: "L12-S7", chinese: "æ–‡æ–‡ç¾åœ¨ä¹Ÿè·Ÿä½ ä¸€èµ·å»å­¸è¯èªå—?", segments: ["æ–‡æ–‡", "ç¾åœ¨", "ä¹Ÿ", "è·Ÿ", "ä½ ", "ä¸€èµ·å»", "å­¸è¯èª", "å—", "?",] },
                    { id: "L12-S8", chinese: "æ˜¯å•Šï¼ä¸Šä¸­æ–‡èª²å¾ˆæœ‰æ„æ€ã€‚", segments: ["æ˜¯å•Š", "ï¼", "ä¸Š", "ä¸­æ–‡èª²", "å¾ˆæœ‰æ„æ€", "ã€‚"] },
                    { id: "L12-S9", chinese: "ä½ å¥½å¥½å­¸è¯èªã€‚", segments: ["ä½ ", "å¥½å¥½", "å­¸è¯èª", "ã€‚"] },
                    { id: "L12-S10", chinese: "ä»¥å¾Œå¯ä»¥ç”¨ç¶²è·¯çµ¦æˆ‘å¯«ä¿¡ã€‚", segments: ["ä»¥å¾Œ", "å¯ä»¥", "ç”¨ç¶²è·¯", "çµ¦æˆ‘", "å¯«ä¿¡", "ã€‚"] },
                    { id: "L12-S11", chinese: "æ²’å•é¡Œï¼Œæˆ‘ä¸€å®šæœƒå¥½å¥½å­¸è¯èªã€‚", segments: ["æ²’å•é¡Œ", "ï¼Œ", "æˆ‘", "ä¸€å®šæœƒ", "å¥½å¥½", "å­¸è¯èª", "ã€‚"] }
                ]
            }
        ];

        // æ•´åˆå¾Œçš„éŠæˆ²è³‡æ–™ (é è¨­ + è‡ªè¨‚)
        let GAME_DATA = [...DEFAULT_GAME_DATA];

        // ç‹€æ…‹è®Šæ•¸
        let state = {
            currentLessonIndex: 0,
            currentSentenceIndex: 0,
            shuffledWords: [],
            userAnswer: [],
            isCorrect: null, // null, true, false
            score: 0,
            combo: 0, // æ–°å¢ Combo
            gameCompleted: false,
            timer: 0,
            intervalId: null
        };

        // ç·¨è¼¯å™¨ç‹€æ…‹
        let editingLessonId = null;

        // Audio Context for sound effects
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // é¼“å‹µèªåº«
        const PRAISE_MESSAGES = [
            "å¤ªæ£’äº†ï¼", "ç¥ä¹å…¶æŠ€ï¼", "å‹¢å¦‚ç ´ç«¹ï¼", "ç„¡äººèƒ½æ“‹ï¼", "å¤ªç¥äº†ï¼", "å®Œç¾ç„¡ç¼ºï¼", "Excellent!", "Awesome!"
        ];

        // DOM å…ƒç´ å¼•ç”¨
        const els = {
            lessonSelect: document.getElementById('lesson-select'),
            progressDisplay: document.getElementById('progress-display'),
            progressBar: document.getElementById('progress-bar'), // æ–°å¢
            progressText: document.getElementById('progress-text'), // æ–°å¢
            comboContainer: document.getElementById('combo-container'), // æ–°å¢
            answerArea: document.getElementById('answer-area'),
            sourceArea: document.getElementById('source-area'),
            feedbackArea: document.getElementById('feedback-area'),
            resetBtn: document.getElementById('reset-btn'),
            checkBtn: document.getElementById('check-btn'),
            nextBtn: document.getElementById('next-btn'),
            ttsBtn: document.getElementById('tts-btn'),
            rankDisplay: document.getElementById('rank-display'),
            timerDisplay: document.getElementById('timer-display'),
            gameCard: document.getElementById('game-card'),
            completionScreen: document.getElementById('completion-screen'),
            completedLessonTitle: document.getElementById('completed-lesson-title'),
            finalRank: document.getElementById('final-rank'),
            finalTime: document.getElementById('final-time'),
            restartBtn: document.getElementById('restart-btn'),
            nextLessonBtn: document.getElementById('next-lesson-btn'),
            confettiContainer: document.getElementById('confetti-container'),
            printLessonTitle: document.getElementById('print-lesson-title'),
            printWorksheetContent: document.getElementById('print-worksheet-content'),
            mainHeader: document.getElementById('main-header'),
            
            // ç·¨è¼¯å™¨ç›¸é—œ
            editModeBtn: document.getElementById('edit-mode-btn'),
            editorModal: document.getElementById('editor-modal'),
            closeEditorBtn: document.getElementById('close-editor-btn'),
            newLessonTitle: document.getElementById('new-lesson-title'),
            newLessonContent: document.getElementById('new-lesson-content'),
            saveLessonBtn: document.getElementById('save-lesson-btn'),
            customLessonsList: document.getElementById('custom-lessons-list'),
            editorFormTitle: document.getElementById('editor-form-title'),
            exportBtn: document.getElementById('export-btn'),
            importFile: document.getElementById('import-file'),
            editorPreview: document.getElementById('editor-preview')
        };

        // åˆå§‹åŒ–
        function init() {
            loadCustomLessons(); // è¼‰å…¥è‡ªè¨‚èª²ç¨‹
            renderLessonSelect();
            startLesson(0);
            
            // ç¶å®šäº‹ä»¶
            els.lessonSelect.addEventListener('change', (e) => startLesson(parseInt(e.target.value)));
            els.resetBtn.addEventListener('click', resetProblem);
            els.checkBtn.addEventListener('click', checkAnswer);
            els.nextBtn.addEventListener('click', nextQuestion);
            els.ttsBtn.addEventListener('click', () => speakText(getCurrentSentence().chinese));
            els.restartBtn.addEventListener('click', () => startLesson(state.currentLessonIndex));
            els.nextLessonBtn.addEventListener('click', () => startLesson((state.currentLessonIndex + 1) % GAME_DATA.length));
            
            // ç·¨è¼¯å™¨äº‹ä»¶
            els.editModeBtn.addEventListener('click', openEditor);
            els.closeEditorBtn.addEventListener('click', closeEditor);
            els.saveLessonBtn.addEventListener('click', saveCustomLesson);
            els.exportBtn.addEventListener('click', exportCustomLessons);
            els.importFile.addEventListener('change', importCustomLessons);
            
            // ç·¨è¼¯å™¨é è¦½äº‹ä»¶
            els.newLessonContent.addEventListener('input', updateEditorPreview);
            
            // å…¨å±€å‡½æ•¸ä¾› HTML onclick èª¿ç”¨
            window.restartLesson = () => startLesson(state.currentLessonIndex);
            window.nextLesson = () => startLesson((state.currentLessonIndex + 1) % GAME_DATA.length);
        }

        // --- éŸ³æ•ˆé‚è¼¯ (Web Audio API) ---
        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const gainNode = audioCtx.createGain();
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // Arpeggio C Major (C5, E5, G5)
                const notes = [523.25, 659.25, 783.99];
                notes.forEach((freq, i) => {
                    const oscillator = audioCtx.createOscillator();
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    oscillator.connect(gainNode);
                    oscillator.start(audioCtx.currentTime + i * 0.08);
                    oscillator.stop(audioCtx.currentTime + i * 0.08 + 0.2);
                });
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            } else if (type === 'correct_combo') {
                // Higher pitch Arpeggio for combo (G5, B5, D6)
                const notes = [783.99, 987.77, 1174.66];
                notes.forEach((freq, i) => {
                    const oscillator = audioCtx.createOscillator();
                    oscillator.type = 'triangle'; // Brighter sound
                    oscillator.frequency.value = freq;
                    oscillator.connect(gainNode);
                    oscillator.start(audioCtx.currentTime + i * 0.06);
                    oscillator.stop(audioCtx.currentTime + i * 0.06 + 0.2);
                });
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            } else if (type === 'wrong') {
                // Low thud
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.3);
                
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- ç·¨è¼¯å™¨é‚è¼¯ ---

        function loadCustomLessons() {
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            if (savedData) {
                try {
                    const customLessons = JSON.parse(savedData);
                    // å°‡è‡ªè¨‚èª²ç¨‹æ¥åœ¨é è¨­èª²ç¨‹å¾Œé¢
                    GAME_DATA = [...DEFAULT_GAME_DATA, ...customLessons];
                } catch (e) {
                    console.error("ç„¡æ³•è¼‰å…¥è‡ªè¨‚èª²ç¨‹", e);
                }
            }
        }

        function openEditor() {
            els.editorModal.classList.remove('hidden');
            resetEditorForm();
            renderCustomLessonList();
            updateEditorPreview(); // åˆå§‹åŒ–é è¦½
        }

        function closeEditor() {
            els.editorModal.classList.add('hidden');
            resetEditorForm();
        }

        function resetEditorForm() {
            editingLessonId = null;
            els.newLessonTitle.value = '';
            els.newLessonContent.value = '';
            els.editorFormTitle.textContent = "æ–°å¢èª²ç¨‹";
            els.saveLessonBtn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                å„²å­˜èª²ç¨‹
            `;
            els.saveLessonBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            els.saveLessonBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            updateEditorPreview(); // é‡ç½®é è¦½
        }

        function updateEditorPreview() {
            const content = els.newLessonContent.value;
            if (!content.trim()) {
                els.editorPreview.innerHTML = '<span class="italic opacity-50">é è¦½å€...</span>';
                return;
            }

            const lines = content.split('\n');
            const html = lines.map((line, idx) => {
                if (!line.trim()) return '';
                const segments = line.split(/[\/\s]+/).filter(s => s.trim() !== '');
                if (segments.length === 0) return '';
                
                const blocks = segments.map(seg => 
                    `<span class="bg-amber-100 text-amber-800 border border-amber-300 px-2 py-1 rounded mx-1 inline-block">${seg}</span>`
                ).join('');
                
                return `<div class="flex items-center mb-1"><span class="text-xs text-gray-400 mr-2 w-4">${idx+1}.</span><div class="flex flex-wrap">${blocks}</div></div>`;
            }).join('');
            
            els.editorPreview.innerHTML = html || '<span class="italic opacity-50">é è¦½å€...</span>';
        }

        function editCustomLesson(id) {
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            if (!savedData) return;
            const customLessons = JSON.parse(savedData);
            const lesson = customLessons.find(l => l.lessonId === id);
            
            if (!lesson) return;

            // å¡«å…¥è¡¨å–®
            els.newLessonTitle.value = lesson.lessonTitle;
            // å°‡å¥å­é‚„åŸæˆæ–‡å­—æ ¼å¼ (segments ç”¨ / åˆ†éš”)
            const contentStr = lesson.sentences.map(s => s.segments.join(' / ')).join('\n');
            els.newLessonContent.value = contentStr;

            // è¨­å®šç·¨è¼¯ç‹€æ…‹
            editingLessonId = id;
            els.editorFormTitle.textContent = "ç·¨è¼¯èª²ç¨‹";
            els.saveLessonBtn.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                æ›´æ–°èª²ç¨‹
            `;
            els.saveLessonBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
            els.saveLessonBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
            
            // æ›´æ–°é è¦½
            updateEditorPreview();
            
            // æ²å‹•åˆ°è¡¨å–®é ‚éƒ¨
            els.editorModal.querySelector('.overflow-y-auto').scrollTop = 0;
        }

        function saveCustomLesson() {
            const title = els.newLessonTitle.value.trim();
            const content = els.newLessonContent.value.trim();

            if (!title || !content) {
                alert("è«‹è¼¸å…¥èª²ç¨‹æ¨™é¡Œèˆ‡å…§å®¹ï¼");
                return;
            }

            // è§£æå…§å®¹
            const lines = content.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) {
                alert("è«‹è¼¸å…¥è‡³å°‘ä¸€å¥å…§å®¹ï¼");
                return;
            }

            const sentences = lines.map((line, idx) => {
                // æ”¯æ´ç”¨ / æˆ– å¤šå€‹ç©ºæ ¼ åˆ†éš”
                let segments = line.split(/[\/\s]+/).filter(s => s.trim() !== '');
                const fullSentence = segments.join('');
                
                return {
                    id: editingLessonId ? `custom-${editingLessonId}-${idx}` : `custom-${Date.now()}-${idx}`,
                    chinese: fullSentence,
                    segments: segments
                };
            });

            // è®€å–ç¾æœ‰è‡ªè¨‚èª²ç¨‹
            let customLessons = [];
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            if (savedData) customLessons = JSON.parse(savedData);

            if (editingLessonId) {
                // æ›´æ–°ç¾æœ‰èª²ç¨‹
                const index = customLessons.findIndex(l => l.lessonId === editingLessonId);
                if (index !== -1) {
                    customLessons[index].lessonTitle = title;
                    customLessons[index].sentences = sentences;
                }
            } else {
                // æ–°å¢èª²ç¨‹
                const newLesson = {
                    lessonId: `custom-${Date.now()}`,
                    lessonTitle: title,
                    sentences: sentences,
                    isCustom: true
                };
                customLessons.push(newLesson);
            }

            // å„²å­˜åˆ° LocalStorage
            localStorage.setItem('chinese_learning_game_custom_data', JSON.stringify(customLessons));

            // é‡æ–°è¼‰å…¥ä¸¦æ›´æ–°ä»‹é¢
            GAME_DATA = [...DEFAULT_GAME_DATA]; // é‡ç½®
            loadCustomLessons();
            renderLessonSelect();
            renderCustomLessonList();
            
            // å¦‚æœæ˜¯ç·¨è¼¯ï¼Œè·³è½‰åˆ°è©²èª²ç¨‹ï¼›å¦‚æœæ˜¯æ–°å¢ï¼Œè·³è½‰åˆ°æœ€å¾Œä¸€å€‹èª²ç¨‹
            let targetIndex;
            if (editingLessonId) {
                targetIndex = GAME_DATA.findIndex(l => l.lessonId === editingLessonId);
                alert("èª²ç¨‹æ›´æ–°æˆåŠŸï¼");
            } else {
                targetIndex = GAME_DATA.length - 1;
                alert("èª²ç¨‹æ–°å¢æˆåŠŸï¼");
            }
            
            resetEditorForm();
            startLesson(targetIndex);
            closeEditor();
        }

        function deleteCustomLesson(id) {
            if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹èª²ç¨‹å—ï¼Ÿ")) return;

            let customLessons = [];
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            if (savedData) customLessons = JSON.parse(savedData);

            const updatedLessons = customLessons.filter(l => l.lessonId !== id);
            localStorage.setItem('chinese_learning_game_custom_data', JSON.stringify(updatedLessons));

            // é‡æ–°è¼‰å…¥
            GAME_DATA = [...DEFAULT_GAME_DATA]; 
            loadCustomLessons();
            renderLessonSelect();
            renderCustomLessonList();
            
            // é‡ç½®ç·¨è¼¯å™¨ç‹€æ…‹ï¼ˆå¦‚æœå‰›å¥½åœ¨ç·¨è¼¯è¢«åˆªé™¤çš„èª²ç¨‹ï¼‰
            if (editingLessonId === id) {
                resetEditorForm();
            }

            // å¦‚æœç•¶å‰åœ¨ç©è¢«åˆªé™¤çš„èª²ï¼Œå›åˆ°ç¬¬ä¸€èª²
            startLesson(0);
        }

        function renderCustomLessonList() {
            // å¾ LocalStorage è®€å–ï¼Œç¢ºä¿é¡¯ç¤ºæ­£ç¢º
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            const customLessons = savedData ? JSON.parse(savedData) : [];

            if (customLessons.length === 0) {
                els.customLessonsList.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">å°šç„¡è‡ªè¨‚èª²ç¨‹</p>';
                return;
            }

            els.customLessonsList.innerHTML = customLessons.map(lesson => `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <span class="font-medium text-gray-700 truncate mr-2">${lesson.lessonTitle}</span>
                    <div class="flex gap-2 shrink-0">
                        <button onclick="editCustomLesson('${lesson.lessonId}')" class="text-blue-500 hover:text-blue-700 text-sm font-bold px-2 py-1 hover:bg-blue-100 rounded transition flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            ç·¨è¼¯
                        </button>
                        <button onclick="deleteCustomLesson('${lesson.lessonId}')" class="text-red-500 hover:text-red-700 text-sm font-bold px-2 py-1 hover:bg-red-100 rounded transition flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            åˆªé™¤
                        </button>
                    </div>
                </div>
            `).join('');
            
            // æŠŠå‡½æ•¸æ›è¼‰åˆ° window
            window.deleteCustomLesson = deleteCustomLesson;
            window.editCustomLesson = editCustomLesson;
        }

        // --- åŒ¯å…¥/åŒ¯å‡º é‚è¼¯ ---

        function exportCustomLessons() {
            const savedData = localStorage.getItem('chinese_learning_game_custom_data');
            if (!savedData || JSON.parse(savedData).length === 0) {
                alert("ç›®å‰æ²’æœ‰è‡ªè¨‚èª²ç¨‹å¯ä»¥åŒ¯å‡ºï¼");
                return;
            }
            
            const blob = new Blob([savedData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chinese_game_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importCustomLessons(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) {
                        alert("æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼è«‹ç¢ºèªåŒ¯å…¥çš„æ˜¯æ­£ç¢ºçš„å‚™ä»½æª”ã€‚");
                        return;
                    }

                    // è®€å–ç¾æœ‰è³‡æ–™
                    let currentData = [];
                    const savedData = localStorage.getItem('chinese_learning_game_custom_data');
                    if (savedData) currentData = JSON.parse(savedData);

                    // åˆä½µè³‡æ–™ (ç°¡å–®åˆä½µï¼Œä¸æª¢æŸ¥é‡è¤‡IDï¼Œå› ç‚ºä½¿ç”¨ Date.now() ID é‡è¤‡æ©Ÿç‡ä½)
                    const newData = [...currentData, ...importedData];
                    localStorage.setItem('chinese_learning_game_custom_data', JSON.stringify(newData));

                    // é‡æ–°è¼‰å…¥
                    GAME_DATA = [...DEFAULT_GAME_DATA];
                    loadCustomLessons();
                    renderLessonSelect();
                    renderCustomLessonList();
                    
                    alert(`æˆåŠŸåŒ¯å…¥ ${importedData.length} å ‚èª²ç¨‹ï¼`);
                    // æ¸…ç©º file inputï¼Œä»¥ä¾¿å¯ä»¥å†æ¬¡é¸æ“‡åŒå€‹æª”æ¡ˆ
                    els.importFile.value = '';
                } catch (error) {
                    console.error(error);
                    alert("åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤æˆ–ææ¯€ã€‚");
                }
            };
            reader.readAsText(file);
        }

        // --- æ—¢æœ‰é‚è¼¯ ---

        function getCurrentLesson() {
            return GAME_DATA[state.currentLessonIndex];
        }

        function getCurrentSentence() {
            return getCurrentLesson().sentences[state.currentSentenceIndex];
        }

        function renderLessonSelect() {
            els.lessonSelect.innerHTML = GAME_DATA.map((lesson, idx) => 
                `<option value="${idx}">${lesson.lessonTitle}</option>`
            ).join('');
        }

        function startLesson(index) {
            // é˜²æ­¢ç´¢å¼•è¶Šç•Œ
            if (index >= GAME_DATA.length) index = 0;

            state.currentLessonIndex = index;
            state.currentSentenceIndex = 0;
            state.score = 0;
            state.combo = 0; // Reset combo
            state.gameCompleted = false;
            state.timer = 0;
            
            els.lessonSelect.value = index;
            els.completionScreen.classList.add('hidden');
            els.gameCard.classList.remove('opacity-20');
            
            // æ¸…é™¤ç‘èŠ±ç‰¹æ•ˆ
            els.confettiContainer.innerHTML = '';
            
            clearInterval(state.intervalId);
            state.intervalId = setInterval(() => {
                if (!state.gameCompleted) {
                    state.timer++;
                    updateHeaderStats();
                }
            }, 1000);

            preparePrintContent();
            resetProblem();
        }

        function resetProblem() {
            const sentence = getCurrentSentence();
            state.shuffledWords = shuffleArray(sentence.segments.map((text, idx) => ({
                id: `word-${idx}-${Date.now()}`,
                text: text
            })));
            state.userAnswer = [];
            state.isCorrect = null;
            
            renderUI();
        }

        function renderUI() {
            const lesson = getCurrentLesson();
            const total = lesson.sentences.length;
            const current = state.currentSentenceIndex + 1;
            const percentage = (current - 1) / total * 100; // Progress bar
            
            els.progressText.textContent = `é€²åº¦: ${current} / ${total}`;
            els.progressBar.style.width = `${percentage}%`;
            updateHeaderStats();

            // æ›´æ–° Combo é¡¯ç¤º
            if (state.combo > 1) {
                els.comboContainer.innerHTML = `
                    <div class="bg-orange-500 text-white px-4 py-1 rounded-full font-bold shadow-lg flex items-center gap-2 combo-badge transform">
                        <span class="text-xl">ğŸ”¥</span> é€£å° x${state.combo}
                    </div>
                `;
            } else {
                els.comboContainer.innerHTML = '';
            }

            els.answerArea.innerHTML = '';
            if (state.userAnswer.length === 0) {
                els.answerArea.innerHTML = `
                    <div class="text-gray-300 text-center w-full py-8 pointer-events-none select-none flex flex-col items-center">
                        <span class="text-4xl mb-2 opacity-20">ğŸ‘‡</span>
                        <span>é»æ“Šä¸‹æ–¹è©èªåŠ å…¥</span>
                    </div>`;
            } else {
                state.userAnswer.forEach((word, index) => {
                    const btn = createWordCard(word, true, index);
                    els.answerArea.appendChild(btn);
                });
            }

            els.sourceArea.innerHTML = '';
            state.shuffledWords.forEach(word => {
                const btn = createWordCard(word, false);
                els.sourceArea.appendChild(btn);
            });

            els.feedbackArea.innerHTML = '';
            els.feedbackArea.className = 'transition-all duration-300 overflow-hidden max-h-0 py-0 text-center font-bold text-lg';
            
            if (state.isCorrect === true) {
                const praise = state.combo > 1 
                    ? PRAISE_MESSAGES[Math.floor(Math.random() * PRAISE_MESSAGES.length)]
                    : "ç­”å°äº†ï¼å¤ªæ£’äº†ï¼";
                
                els.feedbackArea.innerHTML = `<span class="flex items-center justify-center gap-2 animate-bounce"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> ${praise}</span>`;
                els.feedbackArea.className = 'transition-all duration-300 overflow-hidden max-h-20 py-2 text-center font-bold text-lg text-green-600 bg-green-100';
            } else if (state.isCorrect === false) {
                els.feedbackArea.innerHTML = '<span class="flex items-center justify-center gap-2 animate-shake">å†è©¦è©¦çœ‹å–”ï¼</span>';
                els.feedbackArea.className = 'transition-all duration-300 overflow-hidden max-h-20 py-2 text-center font-bold text-lg text-red-500 bg-red-100';
                
                // Shake effect on game card
                els.gameCard.classList.add('shake-element');
                setTimeout(() => els.gameCard.classList.remove('shake-element'), 500);
            }

            if (state.isCorrect === true) {
                els.resetBtn.classList.add('hidden');
                els.checkBtn.classList.add('hidden');
                els.nextBtn.classList.remove('hidden');
            } else {
                els.resetBtn.classList.remove('hidden');
                els.checkBtn.classList.remove('hidden');
                els.nextBtn.classList.add('hidden');
                
                if (state.userAnswer.length > 0) {
                    els.checkBtn.disabled = false;
                    els.checkBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                    els.checkBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                } else {
                    els.checkBtn.disabled = true;
                    els.checkBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
                    els.checkBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                }
            }
        }

        function createWordCard(wordObj, isAnswerArea, index = -1) {
            const div = document.createElement('div');
            let classes = "text-lg md:text-2xl px-4 py-2 rounded-xl shadow-md border-b-4 transition-all transform active:scale-95 duration-200 cursor-pointer select-none flex items-center gap-2 ";
            
            if (state.isCorrect === true) {
                classes += "bg-green-500 text-white border-green-700 scale-105 cursor-default ";
            } else if (state.isCorrect === false && isAnswerArea) {
                classes += "bg-red-100 text-red-600 border-red-300 hover:bg-red-200 ";
            } else if (isAnswerArea) {
                classes += "bg-blue-50 text-blue-800 border-blue-200 hover:bg-blue-100 hover:border-blue-300 ";
            } else {
                classes += "bg-white text-gray-700 border border-gray-200 border-b-4 border-gray-300 hover:bg-white hover:border-amber-300 hover:text-amber-600 hover:border-b-amber-400 hover:-translate-y-1 active:translate-y-0 active:border-b-0 ";
            }

            div.className = classes;
            div.textContent = wordObj.text;

            if (isAnswerArea && state.isCorrect !== true) {
                div.draggable = true;
                const grip = document.createElement('span');
                grip.innerHTML = '<svg class="w-4 h-4 text-blue-300 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>';
                div.prepend(grip);

                div.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    div.classList.add('dragging');
                    window.draggedItemIndex = index;
                });
                div.addEventListener('dragend', (e) => {
                    div.classList.remove('dragging');
                    window.draggedItemIndex = null;
                    document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                });
                div.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    if (window.draggedItemIndex !== index) {
                        div.classList.add('drag-over');
                    }
                });
                div.addEventListener('dragleave', (e) => {
                    div.classList.remove('drag-over');
                });
                div.addEventListener('dragover', (e) => e.preventDefault());
                div.addEventListener('drop', (e) => {
                    e.preventDefault();
                    div.classList.remove('drag-over');
                    const fromIndex = window.draggedItemIndex;
                    const toIndex = index;
                    
                    if (fromIndex !== null && fromIndex !== toIndex) {
                        const item = state.userAnswer.splice(fromIndex, 1)[0];
                        state.userAnswer.splice(toIndex, 0, item);
                        state.isCorrect = null; 
                        renderUI();
                    }
                });
            }

            div.addEventListener('click', () => {
                if (state.isCorrect === true) return;

                if (isAnswerArea) {
                    state.userAnswer = state.userAnswer.filter(w => w.id !== wordObj.id);
                    state.shuffledWords.push(wordObj);
                } else {
                    state.shuffledWords = state.shuffledWords.filter(w => w.id !== wordObj.id);
                    state.userAnswer.push(wordObj);
                }
                state.isCorrect = null;
                renderUI();
            });

            return div;
        }

        function checkAnswer() {
            const userString = state.userAnswer.map(w => w.text).join("");
            const targetString = getCurrentSentence().segments.join("");

            if (userString === targetString) {
                state.isCorrect = true;
                state.combo++; // é€£å°å¢åŠ 
                state.score += (10 + (state.combo - 1) * 2); // åŸºç¤åˆ†10 + é€£å°åŠ æˆ
                
                playSound(state.combo > 1 ? 'correct_combo' : 'correct'); // æ’­æ”¾éŸ³æ•ˆ
                speakText(targetString);
                renderUI();
            } else {
                state.isCorrect = false;
                state.combo = 0; // é‡ç½®é€£å°
                playSound('wrong'); // æ’­æ”¾éŸ³æ•ˆ
                renderUI();
            }
        }

        function nextQuestion() {
            if (state.currentSentenceIndex < getCurrentLesson().sentences.length - 1) {
                state.currentSentenceIndex++;
                resetProblem();
            } else {
                // Update final progress bar to 100%
                els.progressBar.style.width = '100%';
                completeGame();
            }
        }

        function completeGame() {
            state.gameCompleted = true;
            clearInterval(state.intervalId);
            
            els.completedLessonTitle.textContent = getCurrentLesson().lessonTitle;
            els.finalRank.textContent = getRankTitle();
            els.finalTime.textContent = formatTime(state.timer);
            
            els.gameCard.classList.add('opacity-20');
            els.completionScreen.classList.remove('hidden');
            
            startConfetti();
        }

        function startConfetti() {
            els.confettiContainer.innerHTML = '';
            const colors = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#6366F1', '#EC4899'];
            
            for (let i = 0; i < 80; i++) {
                const div = document.createElement('div');
                div.className = 'confetti-piece';
                const isFlower = Math.random() > 0.8;
                const size = 8 + Math.random() * 8;
                
                div.style.left = Math.random() * 100 + '%';
                div.style.backgroundColor = isFlower ? 'transparent' : colors[Math.floor(Math.random() * colors.length)];
                div.style.width = isFlower ? 'auto' : size + 'px';
                div.style.height = isFlower ? 'auto' : size + 'px';
                div.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
                div.style.animation = `confetti-fall ${2 + Math.random() * 3}s linear ${Math.random() * 2}s infinite`;
                
                if (isFlower) {
                    div.textContent = 'ğŸŒ¸';
                    div.style.fontSize = (size * 2) + 'px';
                }
                
                els.confettiContainer.appendChild(div);
            }
        }

        function updateHeaderStats() {
            const rank = getRankTitle();
            els.rankDisplay.textContent = rank;
            els.timerDisplay.textContent = formatTime(state.timer);
        }

        function getRankTitle() {
            const totalQuestions = getCurrentLesson().sentences.length;
            // æ»¿åˆ†é‚è¼¯ç•¥å¾®èª¿æ•´ï¼Œå› ç‚ºæœ‰é€£å°åŠ åˆ†ï¼Œé€™è£¡åªç”¨åŸºæœ¬åˆ†ç®—ç™¾åˆ†æ¯”
            // æˆ–è€…ç°¡å–®åˆ¤å®šï¼šåªè¦å…¨å°å°±æ˜¯é”äºº
            const baseScore = state.score; 
            
            // ç°¡å–®èµ·è¦‹ï¼Œé‚„æ˜¯ç”¨å®Œæˆåº¦æˆ–é¡Œç›®æ•¸ä¾†ä¼°ç®—ï¼Œä½†ä¿æŒåŸæœ‰é‚è¼¯
            // é€™è£¡å¯ä»¥ä¿æŒåŸæ¨£ï¼Œå› ç‚ºåˆ†æ•¸åªæœƒæ›´é«˜
            const totalPossibleBase = totalQuestions * 10;
            
            if (state.score >= totalPossibleBase && totalPossibleBase > 0) return "å¥å­é”äºº";
            
            const pct = state.score / totalPossibleBase;
            if (pct === 0) return "ä¿®ç·´ä¸­";
            if (pct < 0.4) return "åˆç´šå­¸å¾’";
            if (pct < 0.8) return "é«˜ç´šå­¸å¾’";
            return "èªæ–‡é«˜æ‰‹";
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const spokenText = text.replace(/éƒ½æœƒ/g, "å…œæœƒ");
                const u = new SpeechSynthesisUtterance(spokenText);
                u.lang = 'zh-TW';
                u.rate = 0.8;
                window.speechSynthesis.speak(u);
            }
        }

        function preparePrintContent() {
            const lesson = getCurrentLesson();
            els.printLessonTitle.textContent = lesson.lessonTitle;
            
            const contentHTML = lesson.sentences.map((sentence, index) => {
                const shuffled = shuffleArray([...sentence.segments]);
                let wordCounter = 1;
                
                return `
                <div class="break-inside-avoid mb-4">
                    <div class="flex gap-2 mb-1 items-center flex-wrap">
                        <span class="font-bold text-lg mr-2">${index + 1}.</span>
                        <div class="flex flex-wrap gap-2">
                            ${shuffled.map((seg) => {
                                const isPunc = /^[ï¼Œã€‚ï¼Ÿï¼ã€ï¼šï¼›ã€Œã€ã€ã€,.?!]+$/.test(seg);
                                let numDisplay = '';
                                if (!isPunc) {
                                    numDisplay = `<span class="text-sm font-bold mr-1 text-gray-600">(${wordCounter})</span>`;
                                    wordCounter++;
                                }
                                return `<span class="border border-black px-3 py-1 rounded text-lg bg-gray-50">${numDisplay}${seg}</span>`;
                            }).join('')}
                        </div>
                    </div>
                    <div class="mt-8 ml-6">
                        <div class="border-b border-black h-8 w-full"></div>
                    </div>
                </div>`;
            }).join('');
            
            els.printWorksheetContent.innerHTML = contentHTML;
        }

        // å•Ÿå‹•ç¨‹å¼
        init();

    </script>
</body>
</html>